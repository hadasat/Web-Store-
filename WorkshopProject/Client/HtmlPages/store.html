<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>WorkShop</title>
    <script type="text/javascript" src="/wot/communication.js"></script>


    <!-- BOOTSTRAP FILES -->
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.3.1/css/bootstrap.min.css">
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.4.0/jquery.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.7/umd/popper.min.js"></script>
    <script src="https://maxcdn.bootstrapcdn.com/bootstrap/4.3.1/js/bootstrap.min.js"></script>

    <!-- NAVBAR -->
    <div id="navbar_header"></div>
    <script type="text/javascript" src="/wot/navbar.js"></script>
</head>

<body>   
<div class="container">
        <div id="page-header" class="pb-2 mt-4 mb-2 border-bottom"></div>

            <!-- Modal -->
<div class="modal fade" id="exampleModal" tabindex="-1" role="dialog" aria-labelledby="exampleModalLabel" aria-hidden="true">
    <div class="modal-dialog" role="document">
      <div class="modal-content">
        <div class="modal-header">
          <h5 class="modal-title" id="exampleModalLabel">Edit Your Store Here! </h5>
          <button type="button" class="close" data-dismiss="modal" aria-label="Close">
            <span aria-hidden="true">&times;</span>
          </button>
        </div>
        <div class="modal-body">
            <h5>Add products</h5>
            <form id="newProduct">
                    <div class="row" style="margin-bottom: 8px;">
                        <div class="col">
                            <input id= "pName" type="text" class="form-control" placeholder="Name" >
                        </div>
                        <div class="col">
                            <input id= "pPrice"type="numbr" id="productPrice" class="form-control" placeholder="Price" required>
                        </div>
                    </div>
                    <div class="row" style="margin-bottom: 8px;">
                            <div class="col">
                            <input  id= "pDesc" type="text" class="form-control" placeholder="Description">
                            </div>
                    </div>
                    <div class="row" style="margin-bottom: 8px;">
                            <div class="col">
                            <input  id= "pCat" type="text" class="form-control" placeholder="Category">
                            </div>
                    </div>
                    <p>
                        <button id="addNewProduct" type="button" class="btn btn-primary">Add</button>
                    </p>
                        
            </form>
            
            <hr>
            <h5>Remove managers</h5>
            <p> <label for="sel1">Select list (select one):</label>
                <select class="form-control" id="sel1">
                  <option>1</option>
                  <option>2</option>
                  <option>3</option>
                  <option>4</option>
                </select></p>
                <button type="button" class="btn btn-outline-info btn-sm">Remove</button>
            <hr>
            <h5>Close store</h5>
            <p>turn your store to be inactive store. you can regret later.</p>
            <button type="button" class="btn btn-danger">Close Now</button>
            <hr>
        </div>
        <div class="modal-footer">
          <button type="button" id="closeStore_btn" class="btn btn-secondary" data-dismiss="modal">Close</button>
          <!-- <button type="button"   data-dismiss="modal" class="btn btn-primary">Save changes</button> -->
        </div>
      </div>
    </div>
  </div>

        <div class="grid row"></div>      
</div>

<script>
    var storeId = getStoreIdFromUrl();

    function init(){
        sendRequest("data","getStore",storeId).then(function(res){
            displayStore(res);
        });
    }
    onStart(init);

    $('#closeStore_btn').on('click',function(){
        sendRequest('action','closeStore',storeId)
        .then(function(){
            alert("store removed successfully");
            window.location.href=`/wot/main`;
        });
    });

    function displayStore(store){
        //set header
        $("#page-header").html(`<h1>${store.name}</h1>
        <h5  style="color: rgb(0, 212, 0)">active</h5><button type="button" class="btn btn-primary btn-sm" data-toggle="modal" data-target="#exampleModal">
                    edit <i class="far fa-edit"></i>
                  </button>`);
        var products = store.Stock;
       // Object.keys(products).forEach((key,index)=> $(".grid").append(createProductCardHtml(products[index])));
        for (var property in products) {
            if (!isNaN(property)) {
                $(".grid").append(createProductCardHtml(products[property]));
            }
        }
    };

    function createProductCardHtml(product){
        // Card Html Component String
        return  `<div class="col-sm-3">`+
                    `<div class="card" style="margin-bottom: 10%;" >`+
                        `<div class="card-header">${product.category} </div>`+
                        `<div class="card-body" >`+
                            `<h5 class="card-title">${product.name.toUpperCase()}</h5>`+
                            `<h6 class="card-subtitle mb-2 text-muted">${product.price} $</h6>`+
                            `<p>${product.description}</p>`+
                           ` <a href="/wot/store/${storeId}/${product.id}" class="btn btn-primary">See More</a>`+
                        ` </div>`+
                       ` <div class="card-footer text-muted">${product.amount} available </div>`+
                    `</div>`+
                `</div>`;
       
    }

    function getStoreIdFromUrl(){
        var url = document.location.href;
        var array = url.split('/');
        return array[array.length-1];
    }

    $('#addNewProduct').click(function(e){
                e.preventDefault();
                var name = $("#pName").val();
                var price = $("#pPrice").val();
                var desc = $("#pDesc").val();
                var cat = $("#pCat").val();
                (name && price && desc && cat) ?
                    addNewProduct(name,price,desc,cat)
                 :
                 alert("add new product error: Please fill all the required fields");
            });

        function addNewProduct (name,price,desc,cat){
            sendRequest('action','addProductToStore',{storeId: storeId, name: name, 
                description: desc, price: price , category: cat}).then(function (res){
                    alert("product added successfully");
                    clearNewProductForm();
                    init();
                })
        }

        function clearNewProductForm(){
            $("#pName").val('');
            $("#pPrice").val('');
            $("#pDesc").val('');
            $("#pCat").val('');
        };
</script>
   
</body>
</html>


